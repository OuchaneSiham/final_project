{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/ochangli/Desktop/tictactoe/frontend/src/lib/config.js"],"sourcesContent":["export const config = {\n  API_BASE_URL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001',\n  SOCKET_URL: process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3001',\n\n  // MUST be a number (backend expects number)\n  CURRENT_USER_ID: Number(process.env.NEXT_PUBLIC_CURRENT_USER_ID || 1),\n}\n"],"names":[],"mappings":";;;;AAAO,MAAM,SAAS;IACpB,cAAc,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IACjD,YAAY,QAAQ,GAAG,CAAC,sBAAsB,IAAI;IAElD,4CAA4C;IAC5C,iBAAiB,OAAO,QAAQ,GAAG,CAAC,2BAA2B,IAAI;AACrE"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/ochangli/Desktop/tictactoe/frontend/src/hooks/useSocket.jsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useState } from 'react'\nimport { io } from 'socket.io-client'\nimport { config } from '@/lib/config'\n\nexport function useSocket() {\n  const socketRef = useRef(null)\n  const [isConnected, setIsConnected] = useState(false)\n\n  useEffect(() => {\n    if (socketRef.current) return\n\n    const socket = io(config.SOCKET_URL, {\n      auth: {\n        userId: config.CURRENT_USER_ID, // required\n      },\n      transports: ['websocket'],\n    })\n\n    socketRef.current = socket\n\n    socket.on('connect', () => {\n      console.log('[socket] connected', socket.id)\n      setIsConnected(true)\n    })\n\n    socket.on('disconnect', () => {\n      console.log('[socket] disconnected')\n      setIsConnected(false)\n    })\n\n    socket.on('connect_error', (err) => {\n      console.error('[socket] error:', err.message)\n    })\n\n    return () => {\n      socket.disconnect()\n      socketRef.current = null\n    }\n  }, [])\n\n  return { socket: socketRef.current, isConnected }\n}\n\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMO,SAAS;IACd,MAAM,YAAY,IAAA,2NAAM,EAAC;IACzB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,6NAAQ,EAAC;IAE/C,IAAA,8NAAS,EAAC;QACR,IAAI,UAAU,OAAO,EAAE;QAEvB,MAAM,SAAS,IAAA,0MAAE,EAAC,0IAAM,CAAC,UAAU,EAAE;YACnC,MAAM;gBACJ,QAAQ,0IAAM,CAAC,eAAe;YAChC;YACA,YAAY;gBAAC;aAAY;QAC3B;QAEA,UAAU,OAAO,GAAG;QAEpB,OAAO,EAAE,CAAC,WAAW;YACnB,QAAQ,GAAG,CAAC,sBAAsB,OAAO,EAAE;YAC3C,eAAe;QACjB;QAEA,OAAO,EAAE,CAAC,cAAc;YACtB,QAAQ,GAAG,CAAC;YACZ,eAAe;QACjB;QAEA,OAAO,EAAE,CAAC,iBAAiB,CAAC;YAC1B,QAAQ,KAAK,CAAC,mBAAmB,IAAI,OAAO;QAC9C;QAEA,OAAO;YACL,OAAO,UAAU;YACjB,UAAU,OAAO,GAAG;QACtB;IACF,GAAG,EAAE;IAEL,OAAO;QAAE,QAAQ,UAAU,OAAO;QAAE;IAAY;AAClD"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/ochangli/Desktop/tictactoe/frontend/src/app/page.jsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useState } from 'react'\nimport { useSocket } from '@/hooks/useSocket'\nimport { config } from '@/lib/config'\nimport { formatDistanceToNow } from 'date-fns'\nimport { Send } from 'lucide-react'\n\nexport default function ChatPage() {\n  const { socket, isConnected } = useSocket()\n  const userId = config.CURRENT_USER_ID\n\n  const [conversations, setConversations] = useState([])\n  const [messages, setMessages] = useState([])\n  const [selectedConversationId, setSelectedConversationId] = useState(null)\n  const [input, setInput] = useState('')\n  const bottomRef = useRef(null)\n\n  // fetch conversations\n  useEffect(() => {\n    if (!isConnected) return\n\n    fetch(`${config.API_BASE_URL}/conversation?userId=${userId}`)\n      .then(res => res.json())\n      .then(data => {\n        const convs = Array.isArray(data)\n          ? data\n          : Array.isArray(data.conversations)\n            ? data.conversations\n            : []\n\n        setConversations(convs)\n\n        if (convs.length && !selectedConversationId) {\n          setSelectedConversationId(convs[0].id)\n        }\n      })\n      .catch(console.error)\n  }, [isConnected])\n\n  // fetch messages for selected conversation\n  useEffect(() => {\n    if (!selectedConversationId) return\n\n    fetch(`${config.API_BASE_URL}/conversation/${selectedConversationId}/messages`)\n      .then(res => res.json())\n      .then(setMessages)\n      .catch(console.error)\n  }, [selectedConversationId])\n\n  // handle incoming socket messages\n  useEffect(() => {\n    if (!socket) return\n\n    const onNewMessage = (msg) => {\n      setMessages(prev =>\n        prev.some(m => m.id === msg.id) ? prev : [...prev, msg]\n      )\n    }\n\n    socket.on('message:new', onNewMessage)\n    return () => {\n      socket.off('message:new', onNewMessage)\n    }\n  }, [socket])\n\n  // scroll to bottom\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const sendMessage = async () => {\n    if (!input.trim() || !selectedConversationId) return\n\n    const res = await fetch(\n      `${config.API_BASE_URL}/conversation/${selectedConversationId}/message`,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId: userId,\n          content: input,\n        }),\n      }\n    )\n\n    const msg = await res.json()\n    setMessages(prev => [...prev, msg])\n    setInput('')\n  }\n\n  return (\n    <div className=\"flex h-screen\">\n      {/* SIDEBAR */}\n      <aside className=\"w-64 border-r\">\n        {Array.isArray(conversations) &&\n          conversations.map(c => (\n            <button\n              key={c.id}\n              onClick={() => setSelectedConversationId(c.id)}\n              className=\"w-full p-3 text-left hover:bg-blue\"\n            >\n              <p className=\"font-medium\">{c.name ?? `Conversation ${c.id}`}</p>\n              <p className=\"text-xs text-muted-foreground\">\n                {c.updatedAt\n                  ? `${formatDistanceToNow(new Date(c.updatedAt))} ago`\n                  : 'â€”'}\n              </p>\n            </button>\n          ))}\n      </aside>\n\n      {/* CHAT */}\n      <main className=\"flex-1 flex flex-col\">\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n          {messages.map((m, index) => {\n            const isMe = m.senderId === userId\n            return (\n              <div\n                key={m.id ?? `msg-${m.senderId}-${m.createdAt}-${index}`}\n                className={`max-w-xs p-2 rounded ${\n                  isMe ? 'bg-blue-500 text-white ml-auto' : 'bg-gray-200'\n                }`}\n              >\n                <div className=\"text-xs opacity-70 mb-1\">\n                  {isMe ? 'You' : m.sender?.username ?? `User ${m.senderId}`}\n                </div>\n                <div>{m.content}</div>\n              </div>\n            )\n          })}\n          <div ref={bottomRef} />\n        </div>\n\n        <div className=\"p-3 border-t flex gap-2\">\n          <input\n            value={input}\n            onChange={e => setInput(e.target.value)}\n            onKeyDown={e => e.key === 'Enter' && sendMessage()}\n            className=\"flex-1 border rounded px-3\"\n            placeholder=\"Message...\"\n          />\n          <button onClick={sendMessage}>\n            <Send />\n          </button>\n        </div>\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}